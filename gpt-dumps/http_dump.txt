===== GPT DUMP GENERATED: 2025-11-13T22:06:49Z =====
===== DIRECTORY: app/Http =====

app/Http/Middleware/RedirectIfAuthenticated.php


===== FILE: app/Http/Middleware/RedirectIfAuthenticated.php =====

<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;

class RedirectIfAuthenticated
{
    /**
     * Handle an incoming request.
     *
     * If the user is authenticated, redirect them to the dashboard.
     */
    public function handle(Request $request, Closure $next, ...$guards)
    {
        $guards = empty($guards) ? [null] : $guards;

        foreach ($guards as $guard) {
            if (Auth::guard($guard)->check()) {
                // ðŸš€ Redirect authenticated users away from login/register/forgot-password pages
                return redirect()->intended('/dashboard');
            }
        }

        return $next($request);
    }
}app/Http/Middleware/HandleInertiaRequests.php


===== FILE: app/Http/Middleware/HandleInertiaRequests.php =====

<?php

namespace App\Http\Middleware;

use Illuminate\Foundation\Inspiring;
use Illuminate\Http\Request;
use Inertia\Middleware;

class HandleInertiaRequests extends Middleware
{
    /**
     * The root template that's loaded on the first page visit.
     *
     * @see https://inertiajs.com/server-side-setup#root-template
     *
     * @var string
     */
    protected $rootView = 'app';

    /**
     * Determines the current asset version.
     *
     * @see https://inertiajs.com/asset-versioning
     */
    public function version(Request $request): ?string
    {
        return parent::version($request);
    }

    /**
     * Define the props that are shared by default.
     *
     * @see https://inertiajs.com/shared-data
     *
     * @return array<string, mixed>
     */
    public function share(Request $request): array
    {
        [$message, $author] = str(Inspiring::quotes()->random())->explode('-');

        return [
            ...parent::share($request),
            'name' => config('app.name'),
            'quote' => ['message' => trim($message), 'author' => trim($author)],
            'auth' => [
                'user' => $request->user(),
            ],
            'sidebarOpen' => ! $request->hasCookie('sidebar_state') || $request->cookie('sidebar_state') === 'true',
        ];
    }
}
app/Http/Middleware/HandleAppearance.php


===== FILE: app/Http/Middleware/HandleAppearance.php =====

<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\View;
use Symfony\Component\HttpFoundation\Response;

class HandleAppearance
{
    /**
     * Handle an incoming request.
     *
     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next
     */
    public function handle(Request $request, Closure $next): Response
    {
        View::share('appearance', $request->cookie('appearance') ?? 'system');

        return $next($request);
    }
}
app/Http/Requests/Settings/ProfileUpdateRequest.php


===== FILE: app/Http/Requests/Settings/ProfileUpdateRequest.php =====

<?php

namespace App\Http\Requests\Settings;

use App\Models\User;
use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Validation\Rule;

class ProfileUpdateRequest extends FormRequest
{
    /**
     * Get the validation rules that apply to the request.
     *
     * @return array<string, \Illuminate\Contracts\Validation\ValidationRule|array<mixed>|string>
     */
    public function rules(): array
    {
        return [
            'name' => ['required', 'string', 'max:255'],
            'email' => [
                'required',
                'string',
                'lowercase',
                'email',
                'max:255',
                Rule::unique(User::class)->ignore($this->user()->id),
            ],
        ];
    }
}
app/Http/Requests/Settings/TwoFactorAuthenticationRequest.php


===== FILE: app/Http/Requests/Settings/TwoFactorAuthenticationRequest.php =====

<?php

namespace App\Http\Requests\Settings;

use Illuminate\Foundation\Http\FormRequest;
use Laravel\Fortify\Features;
use Laravel\Fortify\InteractsWithTwoFactorState;

class TwoFactorAuthenticationRequest extends FormRequest
{
    use InteractsWithTwoFactorState;

    /**
     * Determine if the user is authorized to make this request.
     */
    public function authorize(): bool
    {
        return Features::enabled(Features::twoFactorAuthentication());
    }

    /**
     * Get the validation rules that apply to the request.
     *
     * @return array<string, \Illuminate\Contracts\Validation\ValidationRule|array<mixed>|string>
     */
    public function rules(): array
    {
        return [];
    }
}
app/Http/Controllers/Settings/ProfileController.php


===== FILE: app/Http/Controllers/Settings/ProfileController.php =====

<?php

namespace App\Http\Controllers\Settings;

use App\Http\Controllers\Controller;
use App\Http\Requests\Settings\ProfileUpdateRequest;
use Illuminate\Contracts\Auth\MustVerifyEmail;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Inertia\Inertia;
use Inertia\Response;

class ProfileController extends Controller
{
    /**
     * Show the user's profile settings page.
     */
    public function edit(Request $request): Response
    {
        return Inertia::render('settings/Profile', [
            'mustVerifyEmail' => $request->user() instanceof MustVerifyEmail,
            'status' => $request->session()->get('status'),
        ]);
    }

    /**
     * Update the user's profile information.
     */
    public function update(ProfileUpdateRequest $request): RedirectResponse
    {
        $request->user()->fill($request->validated());

        if ($request->user()->isDirty('email')) {
            $request->user()->email_verified_at = null;
        }

        $request->user()->save();

        return to_route('profile.edit');
    }

    /**
     * Delete the user's profile.
     */
    public function destroy(Request $request): RedirectResponse
    {
        $request->validate([
            'password' => ['required', 'current_password'],
        ]);

        $user = $request->user();

        Auth::logout();

        $user->delete();

        $request->session()->invalidate();
        $request->session()->regenerateToken();

        return redirect('/');
    }
}
app/Http/Controllers/Settings/PasswordController.php


===== FILE: app/Http/Controllers/Settings/PasswordController.php =====

<?php

namespace App\Http\Controllers\Settings;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Validation\Rules\Password;
use Inertia\Inertia;
use Inertia\Response;

class PasswordController extends Controller
{
    /**
     * Show the user's password settings page.
     */
    public function edit(): Response
    {
        return Inertia::render('settings/Password');
    }

    /**
     * Update the user's password.
     */
    public function update(Request $request): RedirectResponse
    {
        $validated = $request->validate([
            'current_password' => ['required', 'current_password'],
            'password' => ['required', Password::defaults(), 'confirmed'],
        ]);

        $request->user()->update([
            'password' => $validated['password'],
        ]);

        return back();
    }
}
app/Http/Controllers/Settings/TwoFactorAuthenticationController.php


===== FILE: app/Http/Controllers/Settings/TwoFactorAuthenticationController.php =====

<?php

namespace App\Http\Controllers\Settings;

use App\Http\Controllers\Controller;
use App\Http\Requests\Settings\TwoFactorAuthenticationRequest;
use Illuminate\Routing\Controllers\HasMiddleware;
use Illuminate\Routing\Controllers\Middleware;
use Inertia\Inertia;
use Inertia\Response;
use Laravel\Fortify\Features;

class TwoFactorAuthenticationController extends Controller implements HasMiddleware
{
    /**
     * Get the middleware that should be assigned to the controller.
     */
    public static function middleware(): array
    {
        return Features::optionEnabled(Features::twoFactorAuthentication(), 'confirmPassword')
            ? [new Middleware('password.confirm', only: ['show'])]
            : [];
    }

    /**
     * Show the user's two-factor authentication settings page.
     */
    public function show(TwoFactorAuthenticationRequest $request): Response
    {
        $request->ensureStateIsValid();

        return Inertia::render('settings/TwoFactor', [
            'twoFactorEnabled' => $request->user()->hasEnabledTwoFactorAuthentication(),
            'requiresConfirmation' => Features::optionEnabled(Features::twoFactorAuthentication(), 'confirm'),
        ]);
    }
}
app/Http/Controllers/HomeController.php


===== FILE: app/Http/Controllers/HomeController.php =====

<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

class HomeController extends Controller
{
    public function index()
    {
        return view('pages.home');
    }
}
app/Http/Controllers/Controller.php


===== FILE: app/Http/Controllers/Controller.php =====

<?php

namespace App\Http\Controllers;

abstract class Controller
{
    //
}
app/Http/Controllers/SearchController.php


===== FILE: app/Http/Controllers/SearchController.php =====

<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\Ticker;
use Illuminate\Support\Str;

class SearchController extends Controller
{
    /**
     * Optionally show a search page (if you want a GET search page)
     */
    public function searchForm(Request $request)
    {
        return view('search');
    }

    /**
     * Perform search: simple lookup by exact ticker symbol, otherwise try name fuzzy match.
     * Then redirect to canonical ticker page.
     */
    public function performSearch(Request $request)
    {
        $q = trim($request->input('q', ''));

        if (empty($q)) {
            return redirect()->route('home')->with('error', 'Please enter a ticker or name.');
        }

        // If the user input looks like a ticker (all alpha-numeric, <=6 chars), try exact match first
        $maybeTicker = preg_match('/^[A-Za-z0-9\.\-]{1,7}$/', $q);

        if ($maybeTicker) {
            $ticker = Ticker::whereRaw('upper(ticker) = ?', [strtoupper($q)])->first();
            if ($ticker) {
                return redirect()->route('tickers.show', ['symbol' => $ticker->ticker, 'slug' => $ticker->slug]);
            }
        }

        // Fallback: try name search (simple LIKE, you can use full-text or Elastic later)
        $ticker = Ticker::where('name', 'like', '%' . $q . '%')->first();

        if ($ticker) {
            return redirect()->route('tickers.show', ['symbol' => $ticker->ticker, 'slug' => $ticker->slug]);
        }

        // No exact matches; redirect back with message
        return redirect()->back()->with('error', 'Ticker not found. Try the exact symbol, e.g., "AAPL" or a company name.');
    }
}app/Http/Controllers/Auth/NewPasswordController.php


===== FILE: app/Http/Controllers/Auth/NewPasswordController.php =====

<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use Inertia\Inertia;
use Inertia\Response;

class NewPasswordController extends Controller
{
    /**
     * Show the password reset page.
     */
    public function create(Request $request): Response
    {
        return Inertia::render('auth/ResetPassword', [
            'token' => $request->route('token'),
            'email' => $request->query('email'),
        ]);
    }

    /**
     * Handle the actual password reset submission.
     */
    public function store(Request $request)
    {
        $request->validate([
            'token' => 'required',
            'email' => 'required|email',
            'password' => 'required|confirmed|min:8',
        ]);

        $status = \Password::reset(
            $request->only('email', 'password', 'password_confirmation', 'token'),
            function ($user, $password) {
                $user->forceFill([
                    'password' => bcrypt($password),
                ])->save();

                $user->setRememberToken(\Str::random(60));

                event(new \Illuminate\Auth\Events\PasswordReset($user));
            }
        );

        return $status === \Password::PASSWORD_RESET
            ? redirect()->route('login')->with('status', __($status))
            : back()->withErrors(['email' => __($status)]);
    }
}app/Http/Controllers/TickerAnalysisController.php


===== FILE: app/Http/Controllers/TickerAnalysisController.php =====

<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Cache;
use App\Models\TickerAnalysis;
use App\Jobs\RunTickerAnalysis;

class TickerAnalysisController extends Controller
{
    /**
     * Handle an AI analysis request for a given ticker.
     */
    public function requestAnalysis(Request $request)
    {
        $validated = $request->validate([
            'ticker'   => 'required|string|max:10',
            'provider' => 'required|string|in:openai,gemini,grok',
        ]);

        $user = Auth::user();
        if (! $user) {
            return response()->json(['message' => 'Unauthorized'], 401);
        }

        $ticker   = strtoupper($validated['ticker']);
        $provider = strtolower($validated['provider']);

        /**
         * 1ï¸âƒ£  Rate limiting per user
         * -----------------------------------------
         * Uses atomic increments to avoid race conditions.
         * Defaults to 500 requests per hour per user, configurable via .env.
         */
        $limit   = config('app.ticker_analysis_rate_limit', 500);
        $window  = config('app.ticker_analysis_rate_window', 60); // minutes
        $rateKey = "ticker_analysis_rate:{$user->id}";

        $count = Cache::add($rateKey, 1, now()->addMinutes($window)) 
            ? 1 
            : Cache::increment($rateKey);

        if ($count > $limit) {
            $ttl = Cache::getExpiration($rateKey) 
                ? now()->addMinutes($window)->toDateTimeString() 
                : now()->addMinutes($window)->toDateTimeString();

            return response()->json([
                'message'   => 'Rate limit exceeded',
                'limit'     => $limit,
                'used'      => $count,
                'remaining' => max(0, $limit - $count),
                'resets_at' => $ttl,
            ], 429);
        }

        /**
         * 2ï¸âƒ£  Check for cached analysis
         * -----------------------------------------
         * Return most recent cached response if found.
         */
        $cacheKey = "ticker_analysis:{$ticker}:{$provider}";
        if ($cached = Cache::get($cacheKey)) {
            return response()->json([
                'cached'     => true,
                'structured' => $cached,
                'analysis'   => $cached['analysis'] ?? ($cached['summary'] ?? ''),
                'message'    => 'Returning cached analysis.',
            ]);
        }

        /**
         * 3ï¸âƒ£  Queue a new analysis job
         * -----------------------------------------
         * Creates a database record and dispatches async job.
         */
        $analysis = TickerAnalysis::create([
            'ticker'       => $ticker,
            'provider'     => $provider,
            'user_id'      => $user->id,
            'model'        => config("services.$provider.model"),
            'status'       => 'pending',
            'requested_at' => now(),
        ]);

        RunTickerAnalysis::dispatch($analysis)->onQueue('ticker_analysis');

        return response()->json([
            'analysis_id' => $analysis->id,
            'status'      => 'queued',
            'message'     => 'Analysis request queued successfully.',
        ]);
    }

    /**
     * Return details for a specific analysis request.
     */
    public function show($id)
    {
        $analysis = TickerAnalysis::findOrFail($id);
        $this->authorize('view', $analysis);

        return response()->json([
            'id'           => $analysis->id,
            'ticker'       => $analysis->ticker,
            'provider'     => $analysis->provider,
            'status'       => $analysis->status,
            'summary'      => $analysis->summary,
            'structured'   => $analysis->structured,
            'model'        => $analysis->model,
            'created_at'   => $analysis->created_at,
            'completed_at' => $analysis->completed_at,
        ]);
    }
}app/Http/Controllers/Api/TickerApiController.php


===== FILE: app/Http/Controllers/Api/TickerApiController.php =====

<?php

namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use App\Models\Ticker;

class TickerApiController extends Controller
{
    public function search(Request $request)
    {
        $q = $request->query('q', '');
        if (empty($q)) {
            return response()->json([]);
        }

        $results = Ticker::where('ticker', 'like', $q . '%')
            ->orWhere('name', 'like', '%' . $q . '%')
            ->limit(10)
            ->get(['ticker', 'name', 'slug']);

        return response()->json($results);
    }
}app/Http/Controllers/TickerController.php


===== FILE: app/Http/Controllers/TickerController.php =====

<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\Ticker;
use Illuminate\Support\Str;
use Illuminate\Support\Carbon;
use App\Helpers\FormatHelper;
use App\Services\PolygonRealtimePriceService;

/**
 * Controller: TickerController
 * -----------------------------------------------------------------------------
 * Renders the Ticker Profile Page and coordinates data aggregation between
 * Eloquent models and Blade views.
 *
 * Responsibilities:
 *  - Load relevant ticker data and relationships (overview, fundamentals,
 *    indicators, price histories, news, analysis)
 *  - Prepare both detailed OHLCV arrays AND lightweight `{x,y}` series
 *    for ApexCharts (with optional down-sampling)
 *  - Compute high-level header stats to match major finance portals
 *  - Enrich with intraday (1-minute delayed) snapshots from Redis/Polygon
 * -----------------------------------------------------------------------------
 */
class TickerController extends Controller
{
    /**
     * Display a single tickerâ€™s profile page.
     *
     * @param  \Illuminate\Http\Request              $request
     * @param  string                                $symbol   The ticker symbol (e.g. "AAPL")
     * @param  string|null                           $slug     Optional SEO-friendly slug
     * @param  \App\Services\PolygonRealtimePriceService  $realtimeService
     * @return \Illuminate\View\View|\Illuminate\Http\RedirectResponse
     */
    public function show(
        Request $request,
        string $symbol,
        ?string $slug = null,
        PolygonRealtimePriceService $realtimeService
    ) {
        // ------------------------------------------------------------------
        // Normalize & Retrieve Ticker
        // ------------------------------------------------------------------
        $symbol = strtoupper(trim($symbol));

        $ticker = Ticker::query()
            ->with([
                'overview',
                'fundamentals'   => fn ($q) => $q->orderByDesc('end_date')->limit(4),
                'priceHistories' => fn ($q) => $q->orderBy('t'),
                'indicators'     => fn ($q) => $q->orderByDesc('t')->limit(50),
                'analysis'       => fn ($q) => $q->latest('created_at'),
                'newsItems'      => fn ($q) => $q->orderByDesc('published_utc')->limit(10),
            ])
            ->bySymbol($symbol)
            ->firstOrFail();

        // ------------------------------------------------------------------
        // Canonical Slug Enforcement (SEO-friendly route)
        // ------------------------------------------------------------------
        $canonicalSlug = $ticker->slug ?? Str::slug($ticker->name ?? $ticker->ticker);
        if ($slug !== $canonicalSlug) {
            return redirect()->route('tickers.show', [
                'symbol' => $symbol,
                'slug'   => $canonicalSlug,
            ]);
        }

        // ------------------------------------------------------------------
        // Detailed OHLCV arrays for 1D, 1W, 1M, 6M, 1Y, 5Y (for cards/analytics)
        // ------------------------------------------------------------------
        $now = Carbon::now();
        $priceHistoryRecords = $ticker->priceHistories()
            ->where('t', '>=', $now->copy()->subYears(5))
            ->orderBy('t', 'asc')
            ->get();

        $rangeConfig = [
            '1D' => ['threshold' => $now->copy()->subDay(),     'fallback' => 1],
            '1W' => ['threshold' => $now->copy()->subWeek(),    'fallback' => 5],
            '1M' => ['threshold' => $now->copy()->subMonth(),   'fallback' => 22],
            '6M' => ['threshold' => $now->copy()->subMonths(6), 'fallback' => 126],
            '1Y' => ['threshold' => $now->copy()->subYear(),    'fallback' => 252],
            '5Y' => ['threshold' => $now->copy()->subYears(5),  'fallback' => 1260],
        ];

        $serializeOHLCV = function ($collection) {
            return $collection->map(fn ($p) => [
                'date'   => \Illuminate\Support\Carbon::parse($p->t)->toDateString(),
                'open'   => $p->o !== null ? (float) $p->o : null,
                'high'   => $p->h !== null ? (float) $p->h : null,
                'low'    => $p->l !== null ? (float) $p->l : null,
                'close'  => $p->c !== null ? (float) $p->c : null,
                'volume' => $p->v !== null ? (int) $p->v : null,
            ])->values();
        };

        $chartData = [];
        foreach ($rangeConfig as $label => $config) {
            if ($priceHistoryRecords->isEmpty()) {
                $chartData[$label] = [];
                continue;
            }
            $subset = $priceHistoryRecords->filter(fn ($r) => $r->t >= $config['threshold']);
            if ($subset->isEmpty()) {
                $subset = $priceHistoryRecords->take(-$config['fallback']);
            }
            $chartData[$label] = $serializeOHLCV($subset);
        }

        // ------------------------------------------------------------------
        // Lightweight `{x,y}` series for ApexCharts (with down-sampling rules)
        // ------------------------------------------------------------------
        $favorSparseForLargeRanges = true;
        $ranges = ['1D', '1W', '1M', '6M', '1Y', '5Y'];

        $chartSeries = [];
        foreach ($ranges as $range) {
            $series = $ticker->buildPriceSeriesForRange($range, $favorSparseForLargeRanges);
            $chartSeries[$range] = $series['points'];
        }

        // ------------------------------------------------------------------
        // Intraday (1-minute) snapshot via Redis/Polygon
        // ------------------------------------------------------------------
        $intradaySnapshot = $realtimeService->getIntradaySnapshotForTicker($ticker);

        // Close time label from the latest *daily* bar (TickerPriceHistory)
        $latestDaily   = $ticker->latestPrice();
        $closeTimeLabel = $latestDaily
            ? Carbon::parse($latestDaily->t)
                ->setTimezone(config('polygon.market_timezone', 'America/New_York'))
                ->format('M j, g:i A T')
            : null;

        // Intraday session labels from snapshot (only if Polygon returned bars)
        $intradaySessionLabel = $intradaySnapshot['session_label']      ?? null;
        $intradayTimeLabel    = $intradaySnapshot['session_time_human'] ?? null;
        $intradaySessionCode  = $intradaySnapshot['session']            ?? null;

        // ------------------------------------------------------------------
        // Header Stats: match expectations from Google/TradingView/Perplexity
        // ------------------------------------------------------------------
        $overview = $ticker->overview; // may be null for some tickers

        $headerStats = [
            // Price & daily change (based on EOD daily data)
            'lastPrice'     => FormatHelper::currency($ticker->last_close),
            'changeAbs'     => FormatHelper::signedCurrencyChange($ticker->day_change_abs),
            'changePct'     => FormatHelper::percent($ticker->day_change_pct),

            // Close-time metadata (EOD, daily-level)
            // Example: "At close: Nov 12, 4:00 PM ET"
            'closeTimeLabel' => $closeTimeLabel
                ? 'At close: ' . $closeTimeLabel
                : 'At close: â€”',

            // Intraday / After-hours / Pre-market metadata
            // Example: "After hours: Nov 12, 7:45 PM ET"
            'intradaySessionCode'  => $intradaySessionCode,
            'intradaySessionLabel' => $intradaySessionLabel,        // "Pre-market", "After hours", etc.
            'intradayTimeLabel'    => $intradayTimeLabel            // "Nov 12, 7:45 PM ET"
                ? ($intradaySessionLabel . ': ' . $intradayTimeLabel)
                : null,

            // Intraday price & change (when available)
            'intradayLastPrice' => $intradaySnapshot['last_price'] ?? null,
            'intradayChangeAbs' => $intradaySnapshot['change_abs'] ?? null,
            'intradayChangePct' => $intradaySnapshot['change_pct'] ?? null,

            // Day ranges & previous close
            'prevClose'     => FormatHelper::currency($ticker->prev_close),
            'open'          => FormatHelper::currency($ticker->day_open),
            'dayHigh'       => FormatHelper::currency($ticker->day_high),
            'dayLow'        => FormatHelper::currency($ticker->day_low),

            // Volume (latest & avg)
            'volume'        => FormatHelper::humanVolume($ticker->volume_latest),
            'avgVolume'     => FormatHelper::humanVolume($ticker->avg_volume_30d),

            // 52-week range
            'high52w'       => FormatHelper::currency($ticker->high_52w),
            'low52w'        => FormatHelper::currency($ticker->low_52w),

            // Market cap & shares
            'marketCap'     => $overview ? FormatHelper::compactCurrency($overview->market_cap ?? null) : 'â€”',
            'sharesOut'     => $overview ? FormatHelper::compactNumber($overview->weighted_shares_outstanding ?? null) : 'â€”',

            // Meta
            'exchange'      => $ticker->exchange_short ?? $ticker->primary_exchange,
            'name'          => $ticker->clean_display_name ?? $ticker->name,
            'logoUrl'       => $ticker->logo_url,
            'iconUrl'       => $ticker->icon_url,
        ];

        // ------------------------------------------------------------------
        // Compile Data for View
        // ------------------------------------------------------------------
        return view('pages.tickers.show', [
            'ticker'           => $ticker,
            'overview'         => $overview,
            'fundamental'      => $ticker->fundamentals->first(),
            'chartData'        => $chartData,
            'chartSeries'      => $chartSeries,
            'latestIndicators' => $ticker->latestIndicators(),
            'headerStats'      => $headerStats,
            'intradaySnapshot' => $intradaySnapshot, // optional if you want more detail in Blade
            'analysis'         => $ticker->analysis,
            'newsItems'        => $ticker->newsItems,
        ]);
    }
}
[EOF: app/Http]
