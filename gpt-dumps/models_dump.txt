===== GPT DUMP GENERATED: 2025-11-13T22:06:49Z =====
===== DIRECTORY: app/Models =====

app/Models/TickerIndicator.php


===== FILE: app/Models/TickerIndicator.php =====

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Carbon;

class TickerIndicator extends Model
{
    use HasFactory;

    protected $table = 'ticker_indicators';

    protected $fillable = [
        'ticker_id',
        'resolution',
        't',
        'indicator',
        'value',
        'meta',
    ];

    protected $casts = [
        't' => 'datetime',
        'meta' => 'array',
        'value' => 'float',
    ];

    public function ticker()
    {
        return $this->belongsTo(Ticker::class);
    }

    /** Scope: by symbol (joins ticker) */
    public function scopeForTicker($query, string $symbol)
    {
        return $query->whereHas('ticker', fn($q) => $q->where('ticker', strtoupper($symbol)));
    }

    /** Scope: by indicator name */
    public function scopeIndicator($query, string $name)
    {
        return $query->where('indicator', $name);
    }

    /** Scope: recent N trading days */
    public function scopeSince($query, string $date)
    {
        return $query->where('t', '>=', $date);
    }

    public function getDateAttribute(): ?string
    {
        return $this->t ? Carbon::parse($this->t)->toDateString() : null;
    }
}
app/Models/TickerFeatureSnapshot.php


===== FILE: app/Models/TickerFeatureSnapshot.php =====

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

/**
 * Class TickerFeatureSnapshot
 *
 * Represents a compact JSON "feature vector" of all computed indicators and analytics
 * for a given ticker and date. Serves as an AI-ready, ML-friendly dataset structure.
 *
 * Example:
 *   {
 *     "sma_20": 142.54,
 *     "ema_12": 144.21,
 *     "rsi_14": 63.2,
 *     "macd": 0.84,
 *     "atr_14": 1.13,
 *     "boll_20_upper": 146.2,
 *     "boll_20_lower": 138.9,
 *     "beta_60": 1.07,
 *     "sharpe_60": 0.94
 *   }
 *
 * Each record corresponds to a unique (ticker_id, t) pair.
 */
class TickerFeatureSnapshot extends Model
{
    protected $table = 'ticker_feature_snapshots';

    protected $fillable = [
        'ticker_id',
        't',
        'indicators',
        'embedding',
    ];

    protected $casts = [
        't' => 'date',
        'indicators' => 'array',
        'embedding' => 'array',
    ];

    /**
     * Relationships
     */
    public function ticker()
    {
        return $this->belongsTo(Ticker::class);
    }
}app/Models/TickerNewsItem.php


===== FILE: app/Models/TickerNewsItem.php =====

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Carbon;

class TickerNewsItem extends Model
{
    use HasFactory;

    /**
     * This table is ingestion-only, so we‚Äôll guard nothing to simplify updates.
     * If you later expose a writable API endpoint, switch to $fillable for safety.
     */
    protected $guarded = [];

    /**
     * Attribute casting.
     * - Arrays are automatically converted to JSON for storage.
     * - Dates use Carbon for easy formatting.
     */
    protected $casts = [
        'published_utc' => 'datetime',
        'tickers_list'  => 'array',
        'keywords'      => 'array',
        'insights'      => 'array',
        'raw'           => 'array',
    ];

    /**
     * Relationships
     */
    public function ticker()
    {
        return $this->belongsTo(Ticker::class);
    }

    /**
     * Query Scopes
     */

    // Limit to recent news items (default: past 7 days)
    public function scopeRecent($query, int $days = 7)
    {
        return $query->where('published_utc', '>=', now()->subDays($days));
    }

    // Limit to a specific ticker symbol
    public function scopeForTicker($query, string $symbol)
    {
        return $query->where('ticker', strtoupper($symbol));
    }

    // Filter by sentiment
    public function scopeWithSentiment($query, ?string $sentiment = null)
    {
        if ($sentiment) {
            return $query->where('insight_sentiment', strtolower($sentiment));
        }
        return $query->whereNotNull('insight_sentiment');
    }

    /**
     * Accessors
     */

    // Human-readable date
    public function getPublishedDateAttribute(): ?string
    {
        return $this->published_utc
            ? Carbon::parse($this->published_utc)->toDateString()
            : null;
    }

    // Short summary preview
    public function getSummaryExcerptAttribute(): ?string
    {
        return $this->summary
            ? mb_strimwidth($this->summary, 0, 140, '‚Ä¶')
            : null;
    }

    // Display publisher name fallback
    public function getPublisherDisplayAttribute(): ?string
    {
        return $this->publisher_name ?? 'Unknown Source';
    }
}app/Models/TickerPriceHistory.php


===== FILE: app/Models/TickerPriceHistory.php =====

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class TickerPriceHistory extends Model
{
    use HasFactory;

    protected $table = 'ticker_price_histories';

    protected $fillable = [
        'ticker_id',
        'o',
        'h',
        'l',
        'c',
        'v',
        'vw',
        't',
        'year',
    ];

    protected $casts = [
        't' => 'datetime',
        'o' => 'float',
        'h' => 'float',
        'l' => 'float',
        'c' => 'float',
        'v' => 'float',
        'vw' => 'float',
        'year' => 'integer',
    ];

    public function ticker()
    {
        return $this->belongsTo(Ticker::class);
    }

    /**
     * Scope for filtering by year.
     */
    public function scopeYear($query, int $year)
    {
        return $query->where('year', $year);
    }
}app/Models/TickerCorrelation.php


===== FILE: app/Models/TickerCorrelation.php =====

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

/**
 * TickerCorrelation
 *
 * Stores pairwise correlation metrics between two tickers on a given date.
 */
class TickerCorrelation extends Model
{
    protected $fillable = [
        'ticker_id_a',
        'ticker_id_b',
        'as_of_date',
        'corr',
        'beta',
        'r2',
    ];

    protected $casts = [
        'as_of_date' => 'date',
        'corr' => 'float',
        'beta' => 'float',
        'r2' => 'float',
    ];

    public $timestamps = true;
}
app/Models/LatestTickerPrice.php


===== FILE: app/Models/LatestTickerPrice.php =====

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class LatestTickerPrice extends Model
{
    protected $table = 'latest_ticker_prices';

    // This model is read-only (it's a SQL VIEW)
    public $timestamps = false;
    protected $guarded = [];

    public static function forTicker(string $ticker)
    {
        return static::where('ticker', $ticker)->first();
    }

    // Optional: make it cast values properly
    protected $casts = [
        't' => 'datetime',
        'o' => 'float', // open
        'h' => 'float', // high
        'l' => 'float', // low
        'c' => 'float', // close
        'v' => 'float', // volume
    ];
}app/Models/DataIntegrityLog.php


===== FILE: app/Models/DataIntegrityLog.php =====

<?php

namespace App\Models;

/**
 * ============================================================================
 *  DataIntegrityLog (alias of DataValidationLog)
 * ============================================================================
 *
 * A logical alias of DataValidationLog that specifically tracks
 * *integrity-level* audits (e.g., null checks, duplicate detection,
 * orphaned foreign keys, or schema anomalies).
 *
 * Uses the same underlying table `data_validation_logs`.
 * ============================================================================
 */
class DataIntegrityLog extends DataValidationLog
{
    // Uses same fillable, casts, and table
}
app/Models/TickerAnalysis.php


===== FILE: app/Models/TickerAnalysis.php =====

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class TickerAnalysis extends Model
{
    protected $fillable = [
        'ticker','user_id','provider','model','request_payload','response_raw',
        'summary','structured','status','requested_at','completed_at',
    ];

    protected $casts = [
        'request_payload' => 'array',
        'response_raw' => 'array',
        'structured' => 'array',
        'requested_at' => 'datetime',
        'completed_at' => 'datetime',
    ];

    public function user() { return $this->belongsTo(User::class); }
}app/Models/User.php


===== FILE: app/Models/User.php =====

<?php

namespace App\Models;

use Illuminate\Contracts\Auth\MustVerifyEmail;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Laravel\Fortify\TwoFactorAuthenticatable;

class User extends Authenticatable implements MustVerifyEmail
{
    /** @use HasFactory<\Database\Factories\UserFactory> */
    use HasFactory, Notifiable, TwoFactorAuthenticatable;

    /**
     * The attributes that are mass assignable.
     *
     * @var list<string>
     */
    protected $fillable = [
        'name',
        'email',
        'password',
    ];

    /**
     * The attributes that should be hidden for serialization.
     *
     * @var list<string>
     */
    protected $hidden = [
        'password',
        'two_factor_secret',
        'two_factor_recovery_codes',
        'remember_token',
    ];

    /**
     * Get the attributes that should be cast.
     *
     * @return array<string, string>
     */
    protected function casts(): array
    {
        return [
            'email_verified_at' => 'datetime',
            'password' => 'hashed',
            'two_factor_confirmed_at' => 'datetime',
        ];
    }
}app/Models/Ticker.php


===== FILE: app/Models/Ticker.php =====

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Carbon;
use Illuminate\Support\Facades\Config;
use Illuminate\Support\Str;

/**
 * Model: Ticker
 * -----------------------------------------------------------------------------
 * Represents a single tradable instrument (stock, ETF, crypto, etc.)
 * as defined by Polygon.io‚Äôs /v3/reference/tickers endpoint.
 *
 * Encapsulates:
 *  - Core reference metadata
 *  - Relationships to market data (prices, indicators, fundamentals, news, analysis)
 *  - Formatting helpers (percent change, market cap, currency)
 *  - Chart helpers for building series and down-sampling large ranges
 *  - Daily/header stats accessors (open, high, low, prevClose, volume, 52-wk range, etc.)
 *  - Market session helpers (regular vs. extended) for header labels
 * -----------------------------------------------------------------------------
 */
class Ticker extends Model
{
    use HasFactory;

    /** @var string */
    protected $table = 'tickers';

    /**
     * Mass assignable attributes.
     *
     * @var array<int, string>
     */
    protected $fillable = [
        // --- Core fields from Polygon.io /v3/reference/tickers ---
        'ticker',
        'name',
        'market',
        'locale',
        'primary_exchange',
        'type',
        'status',
        'active',
        'currency_symbol',
        'currency_name',
        'base_currency_symbol',
        'base_currency_name',
        'cik',
        'composite_figi',
        'share_class_figi',
        'last_updated_utc',
        'delisted_utc',
        'raw',

        // --- Enriched / Overview metadata ---
        'description',
        'homepage_url',
        'list_date',
        'phone_number',
        'total_employees',
        'sic_code',
        'sic_description',
        'share_class_shares_outstanding',
        'weighted_shares_outstanding',
        'ticker_root',
        'ticker_suffix',
        'round_lot',
        'branding_logo_url',
        'branding_icon_url',
        'address_json',
    ];

    /**
     * Attribute casting.
     *
     * @var array<string, string>
     */
    protected $casts = [
        'active'                         => 'boolean',
        'raw'                            => 'array',
        'last_updated_utc'               => 'datetime',
        'delisted_utc'                   => 'datetime',
        'list_date'                      => 'date',
        'total_employees'                => 'integer',
        'share_class_shares_outstanding' => 'integer',
        'weighted_shares_outstanding'    => 'integer',
        'round_lot'                      => 'integer',
        'address_json'                   => 'array',
    ];

    /** @var bool */
    public $timestamps = true;

    /* ----------------------------------------------------------------------
     | Relationships
     | ---------------------------------------------------------------------- */

    public function overviews()
    {
        return $this->hasMany(TickerOverview::class, 'ticker_id');
    }

    public function overview()
    {
        return $this->hasOne(TickerOverview::class, 'ticker_id')->latestOfMany();
    }

    public function fundamentals()
    {
        return $this->hasMany(TickerFundamental::class, 'ticker_id');
    }

    public function priceHistories()
    {
        return $this->hasMany(TickerPriceHistory::class, 'ticker_id');
    }

    public function indicators()
    {
        return $this->hasMany(TickerIndicator::class, 'ticker_id');
    }

    public function analyses()
    {
        return $this->hasMany(TickerAnalysis::class, 'ticker', 'ticker');
    }

    public function analysis()
    {
        return $this->hasOne(TickerAnalysis::class, 'ticker', 'ticker')->latestOfMany();
    }

    public function newsItems()
    {
        return $this->hasMany(TickerNewsItem::class, 'ticker_id');
    }

    /* ----------------------------------------------------------------------
     | Derived Accessors & Helpers (display)
     | ---------------------------------------------------------------------- */

    /**
     * SEO-friendly slug.
     *
     * @return string
     *
     * @example
     * <a href="{{ route('tickers.show', [$ticker->ticker, $ticker->slug]) }}">
     *   {{ $ticker->clean_display_name ?? $ticker->name }}
     * </a>
     */
    public function getSlugAttribute($value): string
    {
        return $value ?: Str::slug($this->name ?? $this->ticker);
    }

    /**
     * Company location derived from address JSON (e.g., "Austin, TX").
     *
     * @return string|null
     *
     * @example
     * <span class="text-slate-400">{{ $ticker->location ?? '‚Äî' }}</span>
     */
    public function getLocationAttribute(): ?string
    {
        $a = $this->address_json;
        if (! $a || ! is_array($a)) {
            return null;
        }

        $city  = $a['city']  ?? null;
        $state = $a['state'] ?? null;

        return $city && $state ? "{$city}, {$state}" : ($city ?? $state ?? null);
    }

    /**
     * Formatted employee count like ‚Äú154,000‚Äù.
     *
     * @return string|null
     *
     * @example
     * <span>{{ $ticker->formatted_employee_count ?? '‚Äî' }}</span>
     */
    public function getFormattedEmployeeCountAttribute(): ?string
    {
        return $this->total_employees ? number_format($this->total_employees) : null;
    }

    /**
     * Latest daily price row (t, o, h, l, c, v).
     *
     * @return \App\Models\TickerPriceHistory|null
     *
     * @example
     * {{ optional($ticker->latestPrice())->c ?? '‚Äî' }}
     */
    public function latestPrice(): ?\App\Models\TickerPriceHistory
    {
        return $this->priceHistories()->latest('t')->first();
    }

    /**
     * Previous daily price row (yesterday) used for prevClose/changes.
     *
     * @return \App\Models\TickerPriceHistory|null
     *
     * @example
     * {{ optional($ticker->previousPrice())->c ?? '‚Äî' }}
     */
    public function previousPrice(): ?\App\Models\TickerPriceHistory
    {
        $rows = $this->priceHistories()
            ->orderBy('t', 'desc')
            ->limit(2)
            ->get();

        // index 0 == latest, 1 == previous
        return $rows->get(1);
    }

    /**
     * Latest indicators row.
     *
     * @return \App\Models\TickerIndicator|null
     *
     * @example
     * {{ optional($ticker->latestIndicators())->rsi ?? '‚Äî' }}
     */
    public function latestIndicators(): ?\App\Models\TickerIndicator
    {
        return $this->indicators()->latest('t')->first();
    }

    /**
     * Fully-qualified branding logo URL (Polygon, adds apiKey in local).
     *
     * @return string|null
     *
     * @example
     * @if ($ticker->logo_url)
     *   <img src="{{ $ticker->logo_url }}" alt="{{ $ticker->clean_display_name ?? $ticker->name }} logo" class="h-8 w-8 rounded" />
     * @endif
     */
    public function getLogoUrlAttribute(): ?string
    {
        $url = $this->branding_logo_url;
        if (! $url) {
            return null;
        }

        if (str_contains($url, 'apiKey=')) {
            return $url;
        }

        if (app()->environment('local') && Config::get('services.polygon.key')) {
            $url .= (str_contains($url, '?') ? '&' : '?')
                . 'apiKey=' . Config::get('services.polygon.key');
        }

        return $url;
    }

    /**
     * Fully-qualified branding icon URL (Polygon, adds apiKey in local).
     *
     * @return string|null
     *
     * @example
     * @if ($ticker->icon_url)
     *   <img src="{{ $ticker->icon_url }}" alt="{{ $ticker->clean_display_name ?? $ticker->name }} icon" class="h-5 w-5 rounded" />
     * @endif
     */
    public function getIconUrlAttribute(): ?string
    {
        $url = $this->branding_icon_url;
        if (! $url) {
            return null;
        }

        if (str_contains($url, 'apiKey=')) {
            return $url;
        }

        if (app()->environment('local') && Config::get('services.polygon.key')) {
            $url .= (str_contains($url, '?') ? '&' : '?')
                . 'apiKey=' . Config::get('services.polygon.key');
        }

        return $url;
    }

    /**
     * Clean base company name (removes trailing instrument descriptors).
     * Example: "Arch Capital Group Ltd. Depositary Shares..." ‚Üí "Arch Capital Group Ltd"
     *
     * @return string|null
     *
     * @example
     * <h1 class="text-xl font-semibold">
     *   {{ $ticker->clean_base_name ?? $ticker->name }}
     * </h1>
     */
    public function getCleanBaseNameAttribute(): ?string
    {
        $name = trim($this->name ?? '');
        if ($name === '') {
            return null;
        }

        // Remove known suffixes but leave identifiers like "Series F" or "Class A"
        $patterns = [
            '/\b(common|ordinary)\s+stock\b/i',
            '/\b(preferred|redeemable|depositary|depository)\s+shares?\b/i',
            '/\bwarrants?\b/i',
            '/\betf\b/i',
            '/\btrust\s+units?\b/i',
            '/\bnotes?\b/i',
            '/\bincome\s+strategy\b/i',
            '/\bfund\b/i',
            '/\bexchange[-\s]*traded\s+fund\b/i',
        ];

        $cleaned = preg_replace($patterns, '', $name);
        $cleaned = preg_replace('/\s{2,}/', ' ', $cleaned);
        $cleaned = trim($cleaned, " \t\n\r\0\x0B-");
        $cleaned = preg_replace('/[,\.\-]+$/', '', $cleaned);

        // Normalize punctuation spacing and capitalization
        $cleaned = preg_replace('/\s*,\s*/', ', ', $cleaned);
        $cleaned = preg_replace('/\s*\.\s*/', '. ', $cleaned);
        $cleaned = preg_replace('/\s{2,}/', ' ', $cleaned);

        return ucfirst($cleaned);
    }

    /**
     * Clean display name that preserves distinguishing identifiers (Series, Class).
     *
     * @return string|null
     *
     * @example
     * <h1 class="text-xl font-semibold">
     *   {{ $ticker->clean_display_name ?? $ticker->name }}
     * </h1>
     */
    public function getCleanDisplayNameAttribute(): ?string
    {
        $name = trim($this->name ?? '');
        if ($name === '') {
            return null;
        }

        $base = $this->clean_base_name ?? $name;

        // Attempt to extract unique identifiers (Series, Class, etc.)
        $matches = [];
        preg_match('/(Series\s+[A-Z0-9]+|Class\s+[A-Z0-9]+)/i', $name, $matches);
        $suffix = $matches[1] ?? null;

        // Detect preferred or warrant instruments
        $isPreferred  = stripos($name, 'preferred') !== false;
        $isWarrant    = stripos($name, 'warrant') !== false;
        $isDepositary = stripos($name, 'depositary') !== false;

        $descriptor = '';
        if ($isPreferred) {
            $descriptor = 'Preferred';
        } elseif ($isWarrant) {
            $descriptor = 'Warrant';
        } elseif ($isDepositary) {
            $descriptor = 'Depositary Shares';
        }

        // Compose readable short display version
        $display = $base;
        if ($suffix || $descriptor) {
            $display .= ' ‚Äì ' . trim(($suffix ?? '') . ' ' . ($descriptor ?? ''));
        }

        // Clean up double spaces and punctuation
        $display = preg_replace('/\s{2,}/', ' ', $display);

        return trim($display, " \t\n\r\0\x0B-");
    }

    /* ----------------------------------------------------------------------
     | Exchange Translators for Polygon.io `primary_exchange`
     | ---------------------------------------------------------------------- */

    /**
     * Descriptive, human-friendly exchange name (e.g., "NASDAQ Stock Market").
     *
     * @return string|null
     *
     * @example
     * <span class="text-slate-400">
     *   {{ $ticker->exchange_name ?? $ticker->primary_exchange }}
     * </span>
     */
    public function getExchangeNameAttribute(): ?string
    {
        $code = strtoupper(trim($this->primary_exchange ?? ''));
        if ($code === '') {
            return null;
        }

        $map = [
            // üá∫üá∏ U.S. Exchanges
            'XNYS'     => 'New York Stock Exchange',
            'XNAS'     => 'NASDAQ Stock Market',
            'XASE'     => 'NYSE American',
            'ARCX'     => 'NYSE Arca',
            'BATS'     => 'Cboe BZX Exchange',
            'OTC'      => 'OTC Markets',
            'OTC LINK' => 'OTC Markets',
            'OTCM'     => 'OTC Markets',
            'OTCBB'    => 'OTC Bulletin Board',

            // üá®üá¶ Canada
            'XTSE'     => 'Toronto Stock Exchange',
            'XTSX'     => 'TSX Venture Exchange',
            'CSE'      => 'Canadian Securities Exchange',

            // üá¨üáß United Kingdom / üá™üá∫ Europe
            'XLON'     => 'London Stock Exchange',
            'IOB'      => 'LSE ‚Äì International Order Book',
            'XETR'     => 'Deutsche B√∂rse (XETRA)',
            'XFRA'     => 'Frankfurt Stock Exchange',
            'XBER'     => 'Berlin Stock Exchange',
            'XMUN'     => 'Munich Stock Exchange',
            'XPAR'     => 'Euronext Paris',

            // üáØüáµ Japan
            'XTKS'     => 'Tokyo Stock Exchange',
            'XJAS'     => 'JASDAQ',

            // üá≠üá∞ Hong Kong
            'XHKG'     => 'Hong Kong Stock Exchange',

            // üáÆüá≥ India
            'XBOM'     => 'Bombay Stock Exchange',
            'XNSE'     => 'National Stock Exchange of India',

            // üá¶üá∫ Australia
            'XASX'     => 'Australian Securities Exchange',

            // üá®üá≠ Switzerland
            'XSWX'     => 'SIX Swiss Exchange',

            // üá∏üá¨ Singapore
            'XSES'     => 'Singapore Exchange',

            // üá®üá≥ China
            'XSHG'     => 'Shanghai Stock Exchange',
            'XSHE'     => 'Shenzhen Stock Exchange',

            // üá∞üá∑ South Korea
            'XKRX'     => 'Korea Exchange',

            // üáßüá∑ Brazil
            'BVMF'     => 'B3 ‚Äì Brasil Bolsa Balc√£o',

            // üáÆüáπ Italy
            'XMIL'     => 'Borsa Italiana',
        ];

        $normalized = preg_replace('/[^A-Z0-9 ]/', '', $code);

        return $map[$normalized]
            ?? $map[str_replace(['.', '-', '_'], '', $normalized)]
            ?? $code;
    }

    /**
     * Short exchange code for UI tags (e.g., "NASDAQ", "NYSE").
     *
     * @return string|null
     *
     * @example
     * <span class="badge">{{ $ticker->exchange_short ?? $ticker->primary_exchange }}</span>
     */
    public function getExchangeShortAttribute(): ?string
    {
        $code = strtoupper(trim($this->primary_exchange ?? ''));
        if ($code === '') {
            return null;
        }

        $map = [
            'XNYS'     => 'NYSE',
            'XNAS'     => 'NASDAQ',
            'XASE'     => 'AMEX',
            'ARCX'     => 'ARCA',
            'BATS'     => 'CBOE',
            'OTC'      => 'OTC',
            'OTC LINK' => 'OTC',

            // Canada
            'XTSE' => 'TSX',
            'XTSX' => 'TSXV',
            'CSE'  => 'CSE',

            // UK / EU
            'XLON' => 'LSE',
            'XETR' => 'XETRA',
            'XFRA' => 'FWB',
            'XPAR' => 'EURONEXT',

            // Asia-Pacific
            'XTKS' => 'TSE',
            'XHKG' => 'HKEX',
            'XASX' => 'ASX',
            'XNSE' => 'NSE',
            'XBOM' => 'BSE',

            // Other
            'XSWX' => 'SIX',
            'XSES' => 'SGX',
            'XSHG' => 'SSE',
            'XSHE' => 'SZSE',
            'XKRX' => 'KRX',
            'BVMF' => 'B3',
            'XMIL' => 'MIL',
        ];

        $normalized = preg_replace('/[^A-Z0-9 ]/', '', $code);

        return $map[$normalized]
            ?? $map[str_replace(['.', '-', '_'], '', $normalized)]
            ?? $code;
    }

    /**
     * Flag indicating whether this is a U.S. exchange.
     *
     * @return bool
     *
     * @example
     * @if ($ticker->is_us_exchange)
     *   <span class="badge badge-success">US</span>
     * @endif
     */
    public function getIsUsExchangeAttribute(): bool
    {
        return in_array($this->exchange_short, [
            'NYSE', 'NASDAQ', 'AMEX', 'ARCA', 'CBOE', 'OTC',
        ], true);
    }

    /* ----------------------------------------------------------------------
     | Daily/Header Stats (derived from price_histories)
     | ---------------------------------------------------------------------- */

    /**
     * Today's open price (from latest row's "o").
     *
     * @return float|null
     *
     * @example
     * {{ $ticker->day_open !== null ? \App\Helpers\FormatHelper::currency($ticker->day_open) : '‚Äî' }}
     */
    public function getDayOpenAttribute(): ?float
    {
        return $this->latestPrice()?->o;
    }

    /**
     * Today's high price (from latest row's "h").
     *
     * @return float|null
     *
     * @example
     * {{ \App\Helpers\FormatHelper::currency($ticker->day_high) }}
     */
    public function getDayHighAttribute(): ?float
    {
        return $this->latestPrice()?->h;
    }

    /**
     * Today's low price (from latest row's "l").
     *
     * @return float|null
     *
     * @example
     * {{ \App\Helpers\FormatHelper::currency($ticker->day_low) }}
     */
    public function getDayLowAttribute(): ?float
    {
        return $this->latestPrice()?->l;
    }

    /**
     * Previous close (yesterday's "c"), used for day change.
     *
     * @return float|null
     *
     * @example
     * {{ \App\Helpers\FormatHelper::currency($ticker->prev_close) }}
     */
    public function getPrevCloseAttribute(): ?float
    {
        return $this->previousPrice()?->c;
    }

    /**
     * Latest close (today's "c").
     *
     * @return float|null
     *
     * @example
     * <span class="text-2xl font-semibold">
     *   {{ \App\Helpers\FormatHelper::currency($ticker->last_close) }}
     * </span>
     */
    public function getLastCloseAttribute(): ?float
    {
        return $this->latestPrice()?->c;
    }

    /**
     * Day change absolute (last_close - prev_close).
     *
     * @return float|null
     *
     * @example
     * {{ \App\Helpers\FormatHelper::signedCurrencyChange($ticker->day_change_abs) }}
     */
    public function getDayChangeAbsAttribute(): ?float
    {
        $last = $this->last_close;
        $prev = $this->prev_close;

        if ($last === null || $prev === null) {
            return null;
        }

        return $last - $prev;
    }

    /**
     * Day change percent vs. previous close.
     *
     * @return float|null
     *
     * @example
     * <span class="{{ ($ticker->day_change_pct ?? 0) >= 0 ? 'text-emerald-500' : 'text-rose-500' }}">
     *   {{ \App\Helpers\FormatHelper::percent($ticker->day_change_pct) }}
     * </span>
     */
    public function getDayChangePctAttribute(): ?float
    {
        $last = $this->last_close;
        $prev = $this->prev_close;

        if ($last === null || $prev === null || $prev == 0.0) {
            return null;
        }

        return (($last - $prev) / $prev) * 100;
    }

    /**
     * Latest daily volume (v).
     *
     * @return int|null
     *
     * @example
     * {{ \App\Helpers\FormatHelper::humanVolume($ticker->volume_latest) }}
     */
    public function getVolumeLatestAttribute(): ?int
    {
        $v = $this->priceHistories()->latest('t')->value('v');

        return $v !== null ? (int) $v : null;
    }

    /**
     * Average daily volume over the last 30 trading days.
     *
     * @return float|null
     *
     * @example
     * {{ \App\Helpers\FormatHelper::humanVolume($ticker->avg_volume_30d) }}
     */
    public function getAvgVolume30dAttribute(): ?float
    {
        return $this->averageVolume(30);
    }

    /**
     * Compute average volume over the last $days non-null rows.
     *
     * @param  int  $days
     * @return float|null
     */
    public function averageVolume(int $days = 30): ?float
    {
        $rows = $this->priceHistories()
            ->whereNotNull('v')
            ->orderBy('t', 'desc')
            ->limit($days)
            ->pluck('v');

        if ($rows->count() === 0) {
            return null;
        }

        return (float) ($rows->sum() / $rows->count());
    }

    /**
     * 52-week high (max "h" over last ~252 trading days).
     *
     * @return float|null
     *
     * @example
     * {{ \App\Helpers\FormatHelper::currency($ticker->high_52w) }}
     */
    public function getHigh52wAttribute(): ?float
    {
        return $this->priceHistories()
            ->orderBy('t', 'desc')
            ->limit(252)
            ->max('h');
    }

    /**
     * 52-week low (min "l" over last ~252 trading days).
     *
     * @return float|null
     *
     * @example
     * {{ \App\Helpers\FormatHelper::currency($ticker->low_52w) }}
     */
    public function getLow52wAttribute(): ?float
    {
        return $this->priceHistories()
            ->orderBy('t', 'desc')
            ->limit(252)
            ->min('l');
    }

    /* ----------------------------------------------------------------------
     | Market Session Helpers (Option C)
     | ----------------------------------------------------------------------
     | Regular session: used for ‚ÄúAt close‚Äù label.
     | Extended session: used for ‚ÄúAfter hours / Pre-market‚Äù label.
     | For now we synthesize extended timestamp as ‚Äúclose + 3h‚Äù so the UI
     | wiring is ready; later you can plug in true intraday feeds.
     | ---------------------------------------------------------------------- */

    /**
     * Get the timezone used for U.S. market session labels.
     *
     * @return \DateTimeZone
     */
    protected function marketTimezone(): \DateTimeZone
    {
        // You can later make this exchange-specific if you support
        // non-US exchanges with local session times.
        return new \DateTimeZone('America/New_York');
    }

    /**
     * Return structured info for the regular session close time.
     *
     * @return array<string, mixed>|null
     *
     * @example
     * @php($regular = $ticker->regularSessionStats())
     * <span class="text-xs text-slate-500">
     *   {{ $regular['label'] ?? 'At close: ‚Äî' }}
     * </span>
     */
    public function regularSessionStats(): ?array
    {
        $latest = $this->latestPrice();
        if (! $latest || ! $latest->t) {
            return null;
        }

        $dt = Carbon::parse($latest->t)->setTimezone($this->marketTimezone());

        return [
            'timestamp' => $dt,
            'label'     => sprintf(
                'At close: %s',
                $dt->format('M j, g:i:s A T')
            ),
        ];
    }

    /**
     * Return structured info for an extended session snapshot.
     *
     * For now we synthesize a plausible timestamp (‚Äúclose + 3h‚Äù) so the UI
     * can be wired in; when you have real pre-market/after-hours prices,
     * you can source both price & timestamp from those feeds.
     *
     * @return array<string, mixed>|null
     *
     * @example
     * @php($extended = $ticker->extendedSessionStats())
     * @if($extended)
     *   <span class="text-xs text-slate-500">
     *     {{ $extended['label'] }}
     *   </span>
     * @endif
     */
    public function extendedSessionStats(): ?array
    {
        $latest = $this->latestPrice();
        if (! $latest || ! $latest->t) {
            return null;
        }

        $dt = Carbon::parse($latest->t)
            ->setTimezone($this->marketTimezone())
            ->addHours(3); // synthetic placeholder

        return [
            'timestamp' => $dt,
            'label'     => sprintf(
                'After hours: %s',
                $dt->format('M j, g:i:s A T')
            ),
        ];
    }

    /* ----------------------------------------------------------------------
     | Analytical Helpers
     | ---------------------------------------------------------------------- */

    /**
     * Percent change over last N days using closing prices.
     *
     * @param  int  $days
     * @return float|null
     *
     * @example
     * {{ \App\Helpers\FormatHelper::percent($ticker->percentChange(5)) }}
     */
    public function percentChange(int $days): ?float
    {
        $latest = $this->latestPrice()?->c;

        $past = $this->priceHistories()
            ->where('t', '<=', now()->subDays($days))
            ->orderByDesc('t')
            ->value('c');

        if ($latest === null || $past === null || $past == 0) {
            return null;
        }

        return (($latest - $past) / $past) * 100;
    }

    /**
     * Market cap formatted like "$1.23 B".
     *
     * @return string
     *
     * @example
     * {{ $ticker->formattedMarketCap() }}
     */
    public function formattedMarketCap(): string
    {
        $value = $this->overview?->market_cap ?? null;

        if ($value === null) {
            return '‚Äî';
        }
        if ($value >= 1_000_000_000) {
            return '$' . number_format($value / 1_000_000_000, 2) . ' B';
        }
        if ($value >= 1_000_000) {
            return '$' . number_format($value / 1_000_000, 2) . ' M';
        }

        return '$' . number_format($value, 0);
    }

    /**
     * Simple currency formatting using the model's currency symbol if present.
     *
     * @param  float|null  $value
     * @return string
     *
     * @example
     * {{ $ticker->formatCurrency($ticker->last_close) }}
     */
    public function formatCurrency(?float $value): string
    {
        if ($value === null) {
            return '‚Äî';
        }

        $symbol = $this->currency_symbol ?: '$';

        return $symbol . number_format($value, 2);
    }

    /**
     * Compact metrics summary (useful for JSON cards, debugging, etc.).
     *
     * @return array<string, mixed>
     *
     * @example
     * {{ \Illuminate\Support\Js::from($ticker->metricsSummary()) }}
     */
    public function metricsSummary(): array
    {
        return [
            'price'         => $this->latestPrice()?->c ?? null,
            'change_5d'     => $this->percentChange(5),
            'change_30d'    => $this->percentChange(30),
            'market_cap'    => $this->overview?->market_cap,
            'volume_latest' => $this->priceHistories()->latest('t')->value('v'),
            'employees'     => $this->total_employees,
            'location'      => $this->location,
        ];
    }

    /* ----------------------------------------------------------------------
     | Chart Helpers (aggregation + down-sampling)
     | ---------------------------------------------------------------------- */

    /**
     * Get daily OHLCV between $start and $end (inclusive), ascending by time.
     *
     * @param  \DateTimeInterface|string|null  $start
     * @param  \DateTimeInterface|string|null  $end
     * @return \Illuminate\Support\Collection<int, array{
     *     t:string,
     *     o:?float,
     *     h:?float,
     *     l:?float,
     *     c:?float,
     *     v:?int
     * }>
     */
    public function ohlcvBetween($start, $end = null)
    {
        $start = $start ? Carbon::parse($start) : null;
        $end   = $end   ? Carbon::parse($end)   : null;

        $q = $this->priceHistories()->where('resolution', '1d');

        if ($start) {
            $q->where('t', '>=', $start);
        }
        if ($end) {
            $q->where('t', '<=', $end);
        }

        return $q->orderBy('t', 'asc')
            ->get(['t', 'o', 'h', 'l', 'c', 'v'])
            ->map(function ($row) {
                $date = Carbon::parse($row->t)->toDateString(); // YYYY-MM-DD

                return [
                    't' => $date,
                    'o' => $row->o !== null ? (float) $row->o : null,
                    'h' => $row->h !== null ? (float) $row->h : null,
                    'l' => $row->l !== null ? (float) $row->l : null,
                    'c' => $row->c !== null ? (float) $row->c : null,
                    'v' => $row->v !== null ? (int) $row->v : null,
                ];
            })
            ->values();
    }

    /**
     * Down-sample a daily time series by keeping roughly every Nth point.
     * Always keeps first & last elements.
     *
     * @param  \Illuminate\Support\Collection  $series
     * @param  int  $stepDays
     * @return \Illuminate\Support\Collection
     */
    public static function downsampleEveryNDays($series, int $stepDays)
    {
        $count = $series->count();
        if ($count <= 2 || $stepDays <= 1) {
            return $series->values();
        }

        $step = max(1, (int) round($stepDays));

        $out = collect();

        foreach ($series->values() as $i => $row) {
            if ($i === 0 || $i % $step === 0 || $i === $count - 1) {
                $out->push($row);
            }
        }

        return $out->values();
    }

    /**
     * Build a chart-ready "price only" series for a named timeframe.
     *
     * @param  string  $range
     * @param  bool    $favorSparseForLargeRanges
     * @return array{
     *     points: array<int, array{x:string,y:?float}>,
     *     meta: array<string, mixed>
     * }
     *
     * @example
     * {{-- Controller already prepares $chartSeries[...] --}}
     * <x-json :data="$chartSeries['1M']" />
     */
    public function buildPriceSeriesForRange(string $range, bool $favorSparseForLargeRanges = true): array
    {
        $now      = Carbon::now();
        $start    = null;
        $stepDays = 1;

        switch (strtoupper($range)) {
            case '1D':
                $start    = $now->copy()->subDays(1);
                $stepDays = 1;
                break;

            case '5D':
            case '1W':
                $start    = $now->copy()->subDays(7);
                $stepDays = 1;
                break;

            case '1M':
                $start    = $now->copy()->subDays(30);
                $stepDays = 1;
                break;

            case '6M':
                $start    = $now->copy()->subMonthsNoOverflow(6);
                $stepDays = 1;
                break;

            case 'YTD':
                $start    = Carbon::create($now->year, 1, 1, 0, 0, 0);
                $stepDays = $favorSparseForLargeRanges ? 3 : 1;
                break;

            case '1Y':
                $start    = $now->copy()->subYear();
                $stepDays = $favorSparseForLargeRanges ? 3 : 1;
                break;

            case '5Y':
                $start    = $now->copy()->subYears(5);
                $stepDays = 5;
                break;

            case 'MAX':
            default:
                $start    = null; // all history
                $stepDays = 7;
                break;
        }

        $series = $this->ohlcvBetween($start, $now);

        if ($stepDays > 1) {
            $series = self::downsampleEveryNDays($series, $stepDays);
        }

        return [
            'points' => $series->map(fn ($row) => ['x' => $row['t'], 'y' => $row['c']])->values()->all(),
            'meta'   => [
                'range'    => strtoupper($range),
                'stepDays' => $stepDays,
                'count'    => $series->count(),
            ],
        ];
    }

    /* ----------------------------------------------------------------------
     | Scopes
     | ---------------------------------------------------------------------- */

    public function scopeActive($query)
    {
        return $query->where('active', true);
    }

    public function scopeBySymbol($query, string $symbol)
    {
        return $query->whereRaw('LOWER(ticker) = ?', [strtolower($symbol)]);
    }
}app/Models/DataValidationLog.php


===== FILE: app/Models/DataValidationLog.php =====

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

/**
 * ============================================================================
 *  DataValidationLog
 * ============================================================================
 *
 * Represents a persisted record of a validation run ‚Äî used by:
 *  - tickers:validate-data
 *  - tickers:integrity-scan
 *  - (future) sentiment & fundamentals validation jobs
 *
 * Each record stores summary metrics, details JSON, and run metadata.
 * ============================================================================
 */
class DataValidationLog extends Model
{
    protected $table = 'data_validation_logs';

    protected $fillable = [
        'entity_type',
        'command_name',
        'total_entities',
        'validated_count',
        'missing_count',
        'details',
        'status',
        'started_at',
        'completed_at',
        'initiated_by',
    ];

    protected $casts = [
        'details' => 'array',
        'started_at' => 'datetime',
        'completed_at' => 'datetime',
    ];
}app/Models/JobBatch.php


===== FILE: app/Models/JobBatch.php =====

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Str;

/**
 * ============================================================================
 *  JobBatch Model (Final - Eloquent-safe)
 * ============================================================================
 *
 * Represents records in the `job_batches` table, used by:
 *   ‚Ä¢ Laravel's native Bus batching system
 *   ‚Ä¢ TickerWolf's custom ingestion monitoring layer
 *
 * Key behaviors:
 *   ‚Ä¢ UUID primary keys
 *   ‚Ä¢ Hybrid timestamp model:
 *       - created_at, finished_at, cancelled_at ‚Üí UNIX epoch (INT)
 *       - updated_at ‚Üí DATETIME (timestamp)
 *   ‚Ä¢ Disables Eloquent‚Äôs built-in timestamp mutation to prevent
 *     overwriting of integer timestamps with formatted datetime strings.
 * ============================================================================
 */
class JobBatch extends Model
{
    use HasFactory;

    /** @var string The table associated with this model. */
    protected $table = 'job_batches';

    /** @var bool Indicates if the model's primary key is auto-incrementing. */
    public $incrementing = false;

    /** @var string The data type of the primary key. */
    protected $keyType = 'string';

    /**
     * Disable automatic timestamp management.
     *
     * We handle created_at/updated_at manually to keep schema consistency.
     */
    public $timestamps = false; // ‚úÖ CRUCIAL FIX

    /** @var array Attributes that can be mass-assigned. */
    protected $fillable = [
        'id',
        'name',
        'total_jobs',
        'pending_jobs',
        'processed_jobs',
        'failed_jobs',
        'status',
        'created_at',
        'updated_at',
    ];

    /** @var array Attribute casting definitions. */
    protected $casts = [
        'total_jobs'     => 'integer',
        'pending_jobs'   => 'integer',
        'processed_jobs' => 'integer',
        'failed_jobs'    => 'integer',
        'created_at'     => 'integer',   // UNIX timestamp
        'updated_at'     => 'datetime',  // full timestamp
    ];

    /**
     * Boot the model and handle UUID + manual timestamps.
     */
    protected static function booted(): void
    {
        static::creating(function ($model) {
            // Generate UUID primary key
            if (empty($model->{$model->getKeyName()})) {
                $model->{$model->getKeyName()} = (string) Str::uuid();
            }

            // Only set timestamps manually
            if (empty($model->created_at)) {
                $model->created_at = now()->getTimestamp();
            }
            if (empty($model->updated_at)) {
                $model->updated_at = now();
            }
        });
    }

    /* ----------------------------------------------------------------------
     |  Domain convenience helpers
     | ---------------------------------------------------------------------- */

    /** Determine if the batch is complete. */
    public function isComplete(): bool
    {
        return $this->pending_jobs <= 0 && $this->failed_jobs === 0;
    }

    /** Determine if the batch has failures. */
    public function hasFailures(): bool
    {
        return $this->failed_jobs > 0;
    }

    /** Mark the batch as complete. */
    public function markComplete(): void
    {
        $this->update(['status' => 'complete']);
    }

    /** Mark the batch as failed. */
    public function markFailed(): void
    {
        $this->update(['status' => 'failed']);
    }
}app/Models/TickerOverview.php


===== FILE: app/Models/TickerOverview.php =====

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Builder;
use Illuminate\Support\Carbon;

/**
 * Model: TickerOverview
 *
 * Represents a daily snapshot of a ticker‚Äôs volatile attributes
 * (market cap, active status, etc.) fetched from Polygon.io.
 *
 * This table stores time-variant metrics and raw API responses
 * for auditing and reprocessing historical data.
 */
class TickerOverview extends Model
{
    use HasFactory;

    /**
     * Explicit table name for clarity.
     */
    protected $table = 'ticker_overviews';

    /**
     * Mass-assignable attributes.
     *
     * Only include fields that actually exist in the ticker_overviews table
     * (after schema cleanup).
     */
    protected $fillable = [
        'ticker_id',
        'overview_date',
        'active',
        'market_cap',
        'status',
        'results_raw',
        'fetched_at',
        'created_at',
        'updated_at',
    ];

    /**
     * Attribute casting for correct data types.
     */
    protected $casts = [
        'active'        => 'boolean',
        'market_cap'    => 'integer',
        'results_raw'   => 'array',
        'overview_date' => 'date',
        'fetched_at'    => 'datetime',
    ];

    /**
     * Relationships
     * -----------------------------------------------------------------
     */

    /**
     * Each overview belongs to a single ticker.
     */
    public function ticker()
    {
        return $this->belongsTo(Ticker::class);
    }

    /**
     * Scopes
     * -----------------------------------------------------------------
     */

    /**
     * Scope: fetch only the latest overview for each ticker.
     *
     * Note:
     * Uses a subquery for MySQL/MariaDB to retrieve the latest ID per ticker.
     */
    public function scopeLatestForEachTicker(Builder $query): Builder
    {
        return $query->whereIn('id', function ($sub) {
            $sub->selectRaw('MAX(id)')
                ->from('ticker_overviews')
                ->groupBy('ticker_id');
        });
    }

    /**
     * Accessors
     * -----------------------------------------------------------------
     */

    /**
     * Nicely formatted market cap for display (e.g., $1.25B).
     */
    public function getFormattedMarketCapAttribute(): ?string
    {
        if (! $this->market_cap) {
            return null;
        }

        $value = $this->market_cap;

        if ($value >= 1_000_000_000) {
            return '$' . number_format($value / 1_000_000_000, 2) . 'B';
        } elseif ($value >= 1_000_000) {
            return '$' . number_format($value / 1_000_000, 2) . 'M';
        }

        return '$' . number_format($value);
    }

    /**
     * Derived convenience accessor for ticker symbol.
     */
    public function getSymbolAttribute(): ?string
    {
        return optional($this->ticker)->ticker;
    }

    /**
     * Utility: Create or update overview record from a Polygon API response.
     *
     * @param  \App\Models\Ticker  $ticker
     * @param  array  $polygonData  Raw Polygon.io results
     * @return static
     */
    public static function fromPolygonResponse(Ticker $ticker, array $polygonData): self
    {
        $parsed = [
            'ticker_id'     => $ticker->id,
            'overview_date' => now()->toDateString(),
            'active'        => $polygonData['active'] ?? null,
            'market_cap'    => $polygonData['market_cap'] ?? null,
            'status'        => $polygonData['status'] ?? (
                ($polygonData['active'] ?? false) ? 'active' : 'inactive'
            ),
            'results_raw'   => $polygonData,
            'fetched_at'    => now(),
        ];

        return static::updateOrCreate(
            ['ticker_id' => $ticker->id, 'overview_date' => $parsed['overview_date']],
            $parsed
        );
    }
}app/Models/TickerFundamental.php


===== FILE: app/Models/TickerFundamental.php =====

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Factories\HasFactory;

class TickerFundamental extends Model
{
    use HasFactory;

    protected $table = 'ticker_fundamentals';

    // This table is ingestion-only; easiest is to allow all mass assignment:
    protected $guarded = [];

    protected $casts = [
        'start_date'            => 'date',
        'end_date'              => 'date',
        'filing_date'           => 'date',
        'balance_sheet'         => 'array',
        'income_statement'      => 'array',
        'cash_flow_statement'   => 'array',
        'comprehensive_income'  => 'array',
        'raw'                   => 'array',
        'fetched_at'            => 'datetime',
    ];

    public function ticker()
    {
        return $this->belongsTo(Ticker::class);
    }

    public function metrics()
    {
        return $this->hasMany(TickerFundamentalMetric::class, 'fundamental_id');
    }
}app/Models/TickerFundamentalMetric.php


===== FILE: app/Models/TickerFundamentalMetric.php =====

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class TickerFundamentalMetric extends Model
{
    use HasFactory;

    protected $table = 'ticker_fundamentals_financials';

    protected $fillable = [
        'ticker_id', 'fundamental_id', 'ticker', 'statement', 'line_item',
        'label', 'unit', 'display_order', 'value',
        'end_date', 'fiscal_period', 'fiscal_year',
    ];

    protected $casts = [
        'value' => 'float',
        'display_order' => 'integer',
        'end_date' => 'date',
        'created_at' => 'datetime',
        'updated_at' => 'datetime',
    ];

    public function ticker()
    {
        return $this->belongsTo(Ticker::class);
    }

    public function fundamental()
    {
        return $this->belongsTo(TickerFundamental::class, 'fundamental_id');
    }
}
[EOF: app/Models]
