===== GPT DUMP GENERATED: 2025-11-03T10:24:19Z =====
===== DIRECTORY: routes =====

routes/settings.php


===== FILE: routes/settings.php =====

<?php

use App\Http\Controllers\Settings\PasswordController;
use App\Http\Controllers\Settings\ProfileController;
use App\Http\Controllers\Settings\TwoFactorAuthenticationController;
use Illuminate\Support\Facades\Route;
use Inertia\Inertia;

Route::middleware('auth')->group(function () {
    Route::redirect('settings', '/settings/profile');

    Route::get('settings/profile', [ProfileController::class, 'edit'])->name('profile.edit');
    Route::patch('settings/profile', [ProfileController::class, 'update'])->name('profile.update');
    Route::delete('settings/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');

    Route::get('settings/password', [PasswordController::class, 'edit'])->name('user-password.edit');

    Route::put('settings/password', [PasswordController::class, 'update'])
        ->middleware('throttle:6,1')
        ->name('user-password.update');

    Route::get('settings/appearance', function () {
        return Inertia::render('settings/Appearance');
    })->name('appearance.edit');

    Route::get('settings/two-factor', [TwoFactorAuthenticationController::class, 'show'])
        ->name('two-factor.show');
});
routes/console.php


===== FILE: routes/console.php =====

<?php

use Illuminate\Foundation\Inspiring;
use Illuminate\Support\Facades\Artisan;
use Illuminate\Console\Scheduling\Schedule;
use Illuminate\Support\Facades\Log;
use App\Schedules\PolygonTickerOverviewsSchedule;

/*
|--------------------------------------------------------------------------
| Console Routes
|--------------------------------------------------------------------------
|
| This file defines your application's custom Artisan commands and schedules.
| It replaces the old app/Console/Kernel.php from pre-Laravel 11 versions.
|
*/

// -------------------------------------------------------------------------
// Simple Example Command
// -------------------------------------------------------------------------
Artisan::command('inspire', function () {
    $this->comment(Inspiring::quote());
})->purpose('Display an inspiring quote');

// -------------------------------------------------------------------------
// Application Schedule Registration
// -------------------------------------------------------------------------
app()->afterResolving(Schedule::class, function (Schedule $schedule) {

    /*
    |--------------------------------------------------------------------------
    | Polygon: Ticker Overview Ingestion
    |--------------------------------------------------------------------------
    | Runs nightly at 8 PM Pacific to pull the latest ticker overview data.
    */
    $schedule->command('polygon:ticker-overviews:ingest')
        ->dailyAt('20:00')
        ->timezone('America/Los_Angeles')
        ->withoutOverlapping()
        ->appendOutputTo(storage_path('logs/polygon/ticker_overviews_cron.log'));


    /*
    |--------------------------------------------------------------------------
    | Polygon: Ticker Price History Ingestion
    |--------------------------------------------------------------------------
    | Runs nightly at 9 PM Pacific to update price history data for all tickers.
    */
    $schedule->command('polygon:ticker-price-histories:ingest --limit=1000')
        ->dailyAt('21:00')
        ->timezone('America/Los_Angeles')
        ->withoutOverlapping()
        ->appendOutputTo(storage_path('logs/polygon/ticker_price_histories_cron.log'));


    /*
    |--------------------------------------------------------------------------
    | Polygon: Batch Cleanup
    |--------------------------------------------------------------------------
    | Cleans up completed or failed job batches older than 30 days.
    | Keeps the job_batches table lean and prevents log bloat.
    */
    $schedule->command('polygon:batches:cleanup --completed --days=30')
        ->dailyAt('23:59')
        ->timezone('America/Los_Angeles')
        ->onSuccess(fn () => Log::info('Polygon batch cleanup ran successfully.'))
        ->appendOutputTo(storage_path('logs/polygon/batch_cleanup_cron.log'));


    /*
    |--------------------------------------------------------------------------
    | Optional: Additional Polygon Schedules
    |--------------------------------------------------------------------------
    | Load modular schedules (if you have additional scheduling logic in classes)
    | such as App\Schedules\PolygonTickerOverviewsSchedule.
    */
    // (new PolygonTickerOverviewsSchedule())($schedule);
});
routes/web.php


===== FILE: routes/web.php =====

<?php

use Illuminate\Support\Facades\Route;
use Inertia\Inertia;
use App\Http\Controllers\TickerController;
use App\Http\Controllers\HomeController;
use App\Http\Controllers\SearchController;
use Illuminate\Foundation\Auth\EmailVerificationRequest;
use App\Http\Controllers\Auth\NewPasswordController;
use App\Http\Controllers\TickerAnalysisController;

// =========================
// Public Routes
// =========================

// Homepage (Blade view)
Route::get('/', [HomeController::class, 'index'])->name('home');

// Redirect /reset-password (no token) to the forgot-password page
Route::get('/reset-password', fn() => redirect()->route('password.request'));

// Guest-only auth pages
Route::middleware('guest')->group(function () {
    Route::get('/login', fn() => Inertia::render('auth/Login'))->name('login');
    Route::get('/register', fn() => Inertia::render('auth/Register'))->name('register');
    Route::get('/forgot-password', fn() => Inertia::render('auth/ForgotPassword'))->name('password.request');

    // Reset Password Routes
    Route::get('/reset-password/{token}', [NewPasswordController::class, 'create'])
        ->name('password.reset');
    Route::post('/reset-password', [NewPasswordController::class, 'store'])
        ->name('password.update');
});

// Search
Route::get('/search', [SearchController::class, 'searchForm'])->name('search.form');
Route::post('/search', [SearchController::class, 'performSearch'])->name('search.perform');

// Canonical ticker profile (Inertia)
Route::get('/tickers/{symbol}/{slug?}', [TickerController::class, 'show'])
    ->where('symbol', '[A-Za-z0-9\.\-]+')
    ->name('tickers.show');

// Convenience redirect /ticker/{symbol}
Route::get('/ticker/{symbol}', fn($symbol) =>
    redirect()->route('tickers.show', ['symbol' => $symbol])
);

// =========================
// Authenticated Routes
// =========================
Route::middleware(['auth', 'verified'])->group(function () {
    Route::get('/dashboard', fn() => Inertia::render('Dashboard'))->name('dashboard');

    // -----------------------------------------
    // Ticker Analysis (AI Generation) Routes
    // -----------------------------------------
    Route::prefix('analysis')->name('analysis.')->group(function () {
        Route::post('/request', [TickerAnalysisController::class, 'requestAnalysis'])
            ->middleware('throttle:60,1') // optional secondary limiter (60 req/min)
            ->name('request');

        Route::get('/{id}', [TickerAnalysisController::class, 'show'])
            ->name('show');
    });
});

// =========================
// Email Verification Routes
// =========================
Route::middleware(['auth'])->group(function () {
    Route::get('/email/verify', fn() => Inertia::render('auth/VerifyEmail'))
        ->name('verification.notice');

    Route::get('/email/verify/{id}/{hash}', function (EmailVerificationRequest $request) {
        $request->fulfill();
        return redirect()->route('dashboard');
    })->middleware(['signed'])->name('verification.verify');

    Route::post('/email/verification-notification', function (Illuminate\Http\Request $request) {
        $request->user()->sendEmailVerificationNotification();
        return back()->with('status', 'verification-link-sent');
    })->middleware(['throttle:6,1'])->name('verification.send');
});

// =========================
// Additional route includes
// =========================
require __DIR__ . '/settings.php';routes/api.php


===== FILE: routes/api.php =====

<?php

use Illuminate\Support\Facades\Route;
use Illuminate\Http\Request;
use App\Models\Ticker;
use App\Http\Controllers\TickerAnalysisController;

/*
|--------------------------------------------------------------------------
| API Routes
|--------------------------------------------------------------------------
|
| These routes are automatically prefixed with /api.
| Updated for Laravel 12 + Sanctum SPA authentication support.
|
| Notes:
| - Sanctum's EnsureFrontendRequestsAreStateful middleware is already
|   registered in bootstrap/app.php (as you configured).
| - The /sanctum/csrf-cookie route is handled automatically by Sanctum.
|
*/

// ---------------------------------------------------------
// ðŸ”’ Authenticated user endpoint (required by Sanctum)
// ---------------------------------------------------------
Route::middleware('auth:sanctum')->get('/user', function (Request $request) {
    return response()->json($request->user());
});

// ---------------------------------------------------------
// ðŸ¤– Public AI provider list (no auth required)
// ---------------------------------------------------------
Route::get('/ai/providers', fn () => response()->json([
    'providers' => [
        ['id' => 'openai', 'name' => 'OpenAI (GPT-4)'],
        ['id' => 'gemini', 'name' => 'Gemini (Google Gemini)'],
        ['id' => 'grok', 'name' => 'Grok (xAI)'],
    ],
]));

// ---------------------------------------------------------
// ðŸ§  Authenticated AI-powered ticker analysis
// ---------------------------------------------------------
Route::middleware('auth:sanctum')->group(function () {
    Route::post('/ai/analysis', [TickerAnalysisController::class, 'requestAnalysis'])
        ->name('api.ai.analysis.request');

    Route::get('/ai/analysis/{id}', [TickerAnalysisController::class, 'show'])
        ->name('api.ai.analysis.show');
});

// ---------------------------------------------------------
// ðŸ” Public ticker search (autocomplete)
// ---------------------------------------------------------
Route::get('/tickers/search', function (Request $request) {
    $q = trim($request->get('q', ''));

    if ($q === '' || strlen($q) < 1) {
        return response()->json([]);
    }

    return Ticker::query()
        ->where('ticker', 'like', "%{$q}%")
        ->orWhere('name', 'like', "%{$q}%")
        ->limit(10)
        ->get(['id', 'ticker', 'name']);
});
[EOF: routes]
